<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Progression tracker</title>
  <style>
    :root { --bg:#0f1115; --panel:#151923; --text:#e6e6e6; --muted:#9aa3b2; --accent:#7aa2ff; --ok:#3ad17b; }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:14px system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:16px 20px;background:linear-gradient(180deg,#161a22,#121620)}
    header h1{margin:0;font-size:18px;letter-spacing:.2px}
    header .actions{display:flex;gap:10px;align-items:center}
    button,.link{border:1px solid #2a3142;background:#1a2130;color:var(--text);padding:8px 10px;border-radius:8px;cursor:pointer}
    button:hover,.link:hover{border-color:#3a4660}
    .wrap{display:grid;grid-template-columns:260px 1fr;gap:14px;height:calc(100% - 64px);padding:0 16px 16px}
    .panel{background:var(--panel);border:1px solid #22283a;border-radius:12px;overflow:auto}
    .filters{padding:12px}
    .filters h3{margin:8px 0 6px 0;font-size:13px;color:var(--muted)}
    .filters .group{display:flex;gap:8px;flex-wrap:wrap}
    .badge{font-size:12px;background:#1a2130;border:1px solid #2a3142;color:var(--text);padding:6px 8px;border-radius:999px;cursor:pointer}
    .badge.active{outline:2px solid var(--accent)}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;padding:12px}
    .tile{position:relative;background:#121722;border:1px solid #22283a;border-radius:10px;overflow:hidden}
    .tile img{width:100%;height:96px;object-fit:contain;background:#0d1118}
    .tile .name{display:block;font-size:12px;text-align:center;padding:6px 6px 8px;color:#d8dcec}
    .tile[data-owned="true"]{border-color:#2d6b48;box-shadow:inset 0 0 0 2px #2d6b48}
    .tile .check{position:absolute;top:6px;right:6px;background:var(--ok);color:#06140c;border-radius:6px;padding:2px 6px;font-weight:700;font-size:11px;display:none}
    .tile[data-owned="true"] .check{display:block}
    .menu{position:fixed;inset:auto auto 0 0;z-index:50;background:#0f141f;border:1px solid #2a3142;border-radius:10px;min-width:220px;display:none;box-shadow:0 8px 30px rgba(0,0,0,.35)}
    .menu.open{display:block}
    .menu header{display:flex;gap:8px;align-items:center;background:transparent;padding:10px 12px;border-bottom:1px solid #232a3d}
    .menu header img{width:22px;height:22px}
    .menu header strong{font-size:13px}
    .menu .item{padding:10px 12px;cursor:pointer}
    .menu .item:hover{background:#151b29}
    .menu .item small{color:var(--muted)}
    footer{color:var(--muted);font-size:12px;text-align:center;padding:10px}
    a{color:#a9c1ff;text-decoration:none}
  </style>
</head>
<body>
  <header>
    <h1>Progression tracker</h1>
    <div class="actions">
      <button id="reset">Reset progress</button>
      <a class="link" href="#" id="export">Export</a>
      <a class="link" href="#" id="import">Import</a>
    </div>
  </header>
  <div class="wrap">
    <section class="panel filters">
      <h3>Filters</h3>
      <div class="group" id="filterGroup"></div>
      <h3 style="margin-top:14px">Legend</h3>
      <div class="group">
        <span class="badge">Click tile to toggle owned</span>
        <span class="badge">Right click for menu</span>
      </div>
    </section>
    <section class="panel">
      <div class="grid" id="grid"></div>
    </section>
  </div>
  <div class="menu" id="ctx">
    <header><img id="ctxImg" alt=""><strong id="ctxName">Item</strong></header>
    <div class="item" id="ctxToggle"></div>
    <div class="item" id="ctxWiki"></div>
  </div>
  <footer>
    Data is loaded from data/items.json. Your progress is stored only in your browser using localStorage.
  </footer>
  <script>
    const LS_KEY = "chart.progress.v1";
    const grid = document.getElementById("grid");
    const filterGroup = document.getElementById("filterGroup");
    const ctx = document.getElementById("ctx");
    const ctxName = document.getElementById("ctxName");
    const ctxImg = document.getElementById("ctxImg");
    const ctxToggle = document.getElementById("ctxToggle");
    const ctxWiki = document.getElementById("ctxWiki");
    let state = {};
    let allTags = [];
    let data = { tags: [], items: [] };
    let activeTag = "";

    function loadState(){ try{ return JSON.parse(localStorage.getItem(LS_KEY) || "{}"); }catch{return {}} }
    function saveState(s){ localStorage.setItem(LS_KEY, JSON.stringify(s)); }

    async function loadData(){
      const res = await fetch("data/items.json");
      data = await res.json();
      allTags = data.tags || [];
      state = loadState();
      renderFilters();
      renderGrid();
    }

    function renderFilters(){
      filterGroup.innerHTML = "";
      const all = document.createElement("span");
      all.className = "badge" + (activeTag === "" ? " active" : "");
      all.textContent = "All";
      all.onclick = ()=>{activeTag=""; renderGrid(); renderFilters();};
      filterGroup.appendChild(all);
      allTags.forEach(tag=>{
        const el = document.createElement("span");
        el.className = "badge" + (activeTag === tag ? " active" : "");
        el.textContent = tag;
        el.onclick = ()=>{activeTag=tag; renderGrid(); renderFilters();};
        filterGroup.appendChild(el);
      });
    }

    function tileTemplate(item){
      const owned = !!state[item.id];
      const tile = document.createElement("button");
      tile.className = "tile";
      tile.setAttribute("data-owned", owned);
      tile.title = item.name;
      tile.oncontextmenu = ev => openMenu(ev, item);
      tile.onclick = () => toggleOwned(item.id);
      const img = item.img ? `<img src="${item.img}" alt="${item.name}">` : `<img alt="${item.name}" />`;
      tile.innerHTML = img + `<span class="check">Owned</span><span class="name">${item.name}</span>`;
      return tile;
    }

    function renderGrid(){
      grid.innerHTML = "";
      const list = (data.items || []).filter(it=>!activeTag || (it.tags||[]).includes(activeTag));
      list.forEach(it=>grid.appendChild(tileTemplate(it)));
    }

    function toggleOwned(id){
      state[id] = !state[id];
      saveState(state);
      renderGrid();
    }

    function openMenu(ev, item){
      ev.preventDefault();
      ctx.classList.add("open");
      const x = ev.clientX, y = ev.clientY;
      const w = 260, h = 140;
      const left = Math.min(x, window.innerWidth - w - 8);
      const top = Math.min(y, window.innerHeight - h - 8);
      ctx.style.left = left + "px";
      ctx.style.top = top + "px";
      ctxName.textContent = item.name;
      ctxImg.src = item.img || "";
      ctxToggle.textContent = (state[item.id] ? "Mark not owned" : "Mark owned");
      ctxToggle.onclick = () => { toggleOwned(item.id); closeMenu(); };
      const wiki = item.wiki || "";
      ctxWiki.innerHTML = wiki ? `Open wiki <br><small>${wiki}</small>` : "No wiki link";
      ctxWiki.onclick = () => { if(wiki) window.open(wiki, "_blank"); closeMenu(); };
      document.addEventListener("click", outsideClose, { once: true });
    }
    function closeMenu(){ ctx.classList.remove("open"); }
    function outsideClose(e){ if(!ctx.contains(e.target)) closeMenu(); }

    document.getElementById("reset").onclick = () => { if(confirm("Reset all progress")){ state = {}; saveState(state); renderGrid(); } };
    document.getElementById("export").onclick = (e) => {
      e.preventDefault();
      const blob = new Blob([JSON.stringify(state,null,2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "progress.json"; a.click();
      URL.revokeObjectURL(url);
    };
    document.getElementById("import").onclick = async (e) => {
      e.preventDefault();
      const input = document.createElement("input");
      input.type = "file"; input.accept = "application/json";
      input.onchange = () => {
        const f = input.files[0]; if(!f) return;
        const reader = new FileReader();
        reader.onload = () => { try { state = JSON.parse(reader.result); saveState(state); renderGrid(); } catch { alert("Bad file"); } };
        reader.readAsText(f);
      };
      input.click();
    };

    loadData();
  </script>
</body>
</html>
